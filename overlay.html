<script type="text/plain" data-filename="overlay.html"><!doctype html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Bonus Hunt Overlay</title>
<link rel="stylesheet" href="/assets/styles.css" />
<style>
body{background:transparent;font-family:Inter,system-ui,Arial}
.wrap{min-width:800px}
.box{background:rgba(0,0,0,.55);border:1px solid rgba(255,255,255,.08);border-radius:14px;padding:12px;color:#fff}
.row{display:flex;align-items:center;justify-content:space-between;gap:12px}
.tiles{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-top:8px}
.tile{background:rgba(0,0,0,.35);border:1px solid rgba(255,255,255,.08);border-radius:10px;padding:8px}
.bar{height:10px;border-radius:999px;background:rgba(255,255,255,.08);overflow:hidden}
.bar>span{display:block;height:100%;background:linear-gradient(90deg,#6aa6ff,#7dd3fc)}
.table{width:100%;margin-top:8px;border-collapse:collapse}
.table th,.table td{padding:6px 8px;border-bottom:1px solid rgba(255,255,255,.08);font-size:14px}
</style>
<script type="module">
import { fmt, totalWin, currentBonus } from '/assets/common.js'
const qs = new URLSearchParams(location.search)
const id = qs.get('id')
const $ = (s)=>document.querySelector(s)
async function getJSON(url){ const r = await fetch(url); return r.json() }


async function render(){
const data = id? await getJSON('/api/hunt/'+id) : await getJSON('/api/active')
const hunt = data.hunt || data.active
if(!hunt){ $('#root').innerHTML = '<div class=box>No active hunt</div>'; return }
const bonuses = Object.values(hunt.bonuses||{}).sort((a,b)=>a.collectedAt-b.collectedAt)
const total = totalWin(hunt)
const sumBet = bonuses.reduce((a,b)=>a+(+b.bet||0),0)
const bex = sumBet? (hunt.spent/sumBet).toFixed(2) : '0'
const cur = currentBonus(hunt)
const prog = hunt.order?.length? Math.min(hunt.currentIndex, hunt.order.length)/hunt.order.length : 0


$('#root').innerHTML = `
<div class=box>
<div style="font-weight:800;margin-bottom:6px">BONUSHUNT INFO <span style="float:right">${bonuses.filter(b=>b.openedAt).length}/${bonuses.length}</span></div>
<div class=bar><span style="width:${(prog*100).toFixed(0)}%"></span></div>
<div class=tiles>
<div class=tile> B.E. X <div style="font-weight:900">${bex}x</div></div>
<div class=tile> TARGET <div style="font-weight:900">${hunt.currency} ${fmt(hunt.startingBalance)}</div></div>
<div class=tile> AVG X <div style="font-weight:900">${bonuses.filter(b=>b.win).length? fmt(total/sumBet): 'x'}</div></div>
<div class=tile> TOTAL WIN <div style="font-weight:900">${hunt.currency} ${fmt(total)}</div></div>
</div>
<div class=tableWrap>
<table class=table>
<thead><tr><th>#</th><th>SLOT</th><th>BET</th><th>MULTI</th><th>WIN</th></tr></thead>
<tbody>
${bonuses.slice(0,10).map((b,i)=>`<tr ${cur&&cur.id===b.id?'style="background:rgba(255,255,255,.06)"':''}><td>${i+1}</td><td>${b.slot}</td><td>${hunt.currency} ${fmt(b.bet)}</td><td>${b.multi? b.multi+'x':'-'}</td><td>${b.win? hunt.currency+' '+fmt(b.win): '-'}</td></tr>`).join('')}
</tbody>
</table>
</div>
</div>`
}


setInterval(render, 1200)
window.addEventListener('DOMContentLoaded', render)
</script>
</head>
<body>
<div id=root class=wrap></div>
</body>
</html></script>
